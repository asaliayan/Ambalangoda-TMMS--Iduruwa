<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Transformer Maintenance Monitoring System Iduruwa CSC - Home
    </title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="/css/home.css" />
    <!-- Link to home-specific CSS -->
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>
          <i class="fas fa-bolt"></i> Transformer Maintenance Monitoring System
        </h1>
        <p>
          Manage and Track Substation Maintenance Information Iduruwa CSC
        </p>
      </header>

      <div class="navigation-grid">
        <a href="/reporting" class="nav-card" id="reporting-link">
          <i class="fas fa-chart-bar"></i>
          <h2>Reporting & Search</h2>
          <p>View and search substation maintenance records</p>
        </a>

        <a
          href="/record-management"
          class="nav-card"
          id="record-management-link"
        >
          <i class="fas fa-database"></i>
          <h2>Record Management</h2>
          <p>Add, update, and delete substation records</p>
        </a>
      </div>

      <div class="quick-stats">
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-server"></i></div>
          <div class="stat-value" id="total-substations">
            <%= electricalData.length %>
          </div>
          <div class="stat-label">Total Substations</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-tools"></i></div>
          <div class="stat-value" id="maintenance-due">0</div>
          <div class="stat-label">Due for Maintenance</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-calendar-alt"></i></div>
          <div class="stat-value" id="next-month-maintenance">0</div>
          <div class="stat-label">Next Month Maintenance</div>
        </div>
      </div>

      <footer class="footer">
        <p>
          &copy; <span id="current-year"></span> Transformer Maintenance
          Monitoring System. All rights reserved.
        </p>
        <p>Created by Asanka Udayanga</p>
      </footer>
    </div>

    <script src="/js/script.js"></script>
    <script>
      // Function to calculate maintenance stats
      function calculateMaintenanceStats(data) {
        const today = new Date();

        // Calculate due for maintenance
        const dueMaintenance = data.filter((item) => {
          const nextMaintenanceDate = item.NextMaintenanceDate
            ? new Date(item.NextMaintenanceDate)
            : null;
          return nextMaintenanceDate && today >= nextMaintenanceDate;
        });

        // Calculate next month maintenance
        const nextMonthEnd = new Date(
          today.getFullYear(),
          today.getMonth() + 2,
          0
        );
        const nextMonthMaintenance = data.filter((item) => {
          const nextMaintenanceDate = item.NextMaintenanceDate
            ? new Date(item.NextMaintenanceDate)
            : null;
          return (
            nextMaintenanceDate &&
            nextMaintenanceDate > today &&
            nextMaintenanceDate <= nextMonthEnd
          );
        });

        // Update the DOM
        document.getElementById("maintenance-due").textContent =
          dueMaintenance.length;
        document.getElementById("next-month-maintenance").textContent =
          nextMonthMaintenance.length;
      }

      // Fetch data and calculate stats
      async function fetchDataAndCalculateStats() {
        try {
          const response = await fetch("/api/records");
          if (!response.ok) throw new Error("Failed to fetch data");
          const data = await response.json();
          calculateMaintenanceStats(data);
        } catch (error) {
          console.error("Error fetching data:", error);
        }
      }

      // Run the function when the page loads
      document.addEventListener("DOMContentLoaded", fetchDataAndCalculateStats);

      // Get the current year
      const currentYear = new Date().getFullYear();
      // Update the year in the footer
      document.getElementById("current-year").textContent = currentYear;
    </script>
  </body>
</html>
